<?php
/**
 * Copyright Â© Magento, Inc. All rights reserved.
 * See COPYING.txt for license details.
 */

/** @var $block \Magento\Catalog\Block\Product\View */
?>
<?php  $_product = $block->getProduct();
$productid = $block->getProduct()->getId();
      $type =  $_product->getResource()->getAttribute('material_type')->getFrontend()->getValue($_product); 
//echo " type - > ".  $type;
 ?>
<?php $buttonTitle = __('Add to Cart'); ?>
<?php if ($_product->isSaleable()) :
 $server = $this->getRequest()->getServer(); 
     
      $objectManager = \Magento\Framework\App\ObjectManager::getInstance(); // Instance of object manager
      $resource = $objectManager->get('Magento\Framework\App\ResourceConnection');
      $connection = $resource->getConnection();
      $tableName = $resource->getTableName('magenest_apo_product'); //gives table name with prefix
      //Select Data from table
      $sql = "Select * FROM " . $tableName." where product_id = ".$productid;
      $result = $connection->fetchAll($sql); // gives associated array, table fields as key in array.
    
//Identifying if user is on mobile browser or not
if(preg_match('/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i',$_SERVER['HTTP_USER_AGENT'])||preg_match('/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i',substr($_SERVER['HTTP_USER_AGENT'],0,4)) ||  strpos($server['HTTP_USER_AGENT'], 'tablet') !== false || strpos($server['HTTP_USER_AGENT'], 'iPad') !== false || empty($result)) {
 
  ?>
  
  <div class="" >
    

    <div id="error-msg" style="display: none"> </div>
           <a href="javascript:void(0);" class="btn button btn-primary " id="calculate">Calculate price </a>
          <div id="loading-image" style="display: none;">
       <img src="<?php echo $block->getViewFileUrl('images/ajax-loader.gif') ?>"  />
    </div>
</div>
<?php
} 
?>
<?php $_product = $block->getProduct() ?>
<?= $block->getProductPriceHtml(
    $_product,
    \Magento\Catalog\Pricing\Price\FinalPrice::PRICE_CODE,
    \Magento\Framework\Pricing\Render::ZONE_ITEM_VIEW,
    [
        'price_id_suffix' => '_clone'
    ]
) ?>
<div class="box-tocart" style="display: none;">
    <div class="fieldset">
        <?php if ($block->shouldRenderQuantity()) :?>
        <div class="field qty">
            <label class="label" for="qty"><span><?= $block->escapeHtml(__('Qty')) ?></span></label>
            <div class="control">
                <input type="number"
                       name="qty"
                       id="qty"
                       min="0"
                       value="<?= $block->getProductDefaultQty() * 1 ?>"
                       title="<?= $block->escapeHtmlAttr(__('Qty')) ?>"
                       class="input-text qty"
                       data-validate="<?= $block->escapeHtmlAttr(json_encode($block->getQuantityValidators())) ?>"
                       />
            </div>
        </div>
        <?php endif; ?>
         <input type="hidden" name="custom_price" value="" id="custom_price_cal">
         <input type="hidden" name="custom_option_price" value="" id="custom_option_price_cal">
         <input type="hidden" name="advanced_custom_option_price" value="" id="advanced_custom_option_price_cal">

        <div class="actions">
            <button type="submit"
                    title="<?= $block->escapeHtmlAttr($buttonTitle) ?>"
                    class="action primary tocart"
                    id="product-addtocart-button" disabled>
                <span><?= $block->escapeHtml($buttonTitle) ?></span>
            </button>
            <?= $block->getChildHtml('', true) ?>
        </div>
    </div>
</div>
<?php endif; ?>
<script type="text/x-magento-init">
    {
        "#product_addtocart_form": {
            "Magento_Catalog/js/validate-product": {}
        }
    }
</script> <?php  ?>
<style type="text/css">

  .fotorama__stage {
    margin-bottom: -61px;
}

  div#error-msg p {
    color: red;
}#maincontent {
    margin-top: 0px;
}
.product-social-links {
    display: none;
}
.product-options-wrapper { border:unset; }
/*.product-info-main .swatch-attribute-label { display: block; }
*/.swatch-option.text {
    min-width: 35px;    background: #ffff; border: 1px solid #21293c;
}
.field.required .label {
    margin: 5px 0;
 min-width: 100px;
    padding: 5px 0px; max-width: 100px; 
}
.field.required .label {
    margin-right: 5px;
}
.field.required {
    display: flex;
}
.swatch-option:not(.disabled):hover {
    border: 1px solid #21293c;
    color: #fff; background: #21293c;
    outline: 1px solid #999;
}
.field.required .label span {
    margin-right: 5px;
    color: #21293c;
    font-size: 15px;
    font-weight: 600;
    letter-spacing: .005em;
    text-transform: uppercase;
}
.product-info-main .swatch-attribute-label{      min-width: 90px;  }
a#calculate {
    background-color: #403767;
}
.input-text.product-custom-option {
    background: transparent;
    border: none;
    padding: 2px 5px;
    border-bottom: 1px solid #000000;
    width:40%;
}
div#loading-image img {
    padding-top: 8px;
    text-align: center;
    margin-left: 15px;
    /* padding: 10px; */
    height: 30px;
}
div#loading-image {
    display: inline-block; }
    span.price-label {
    display: none !important;
} 
.stock.available {
    display: none;
}
.product-info-main .product.attibute.overview, .product-info-main .product.attribute.overview {
    margin: 15px 0;
}
.product-info-main .product-info-stock-sku {
    padding-bottom: 0px;
    padding-left: 0px;
    padding: 0px;
    margin: 0px;
    text-align: left;
}
.product-options-bottom .price-box, .product-info-price .price-box {
    padding-bottom: 0px;
    padding-top: 5px; padding-left: 5px;
}
.product-info-main .product-options-bottom .box-tocart { margin:0px; }

.product-info-main .fieldset > .field.qty, .product-info-main .nested.options-list>.field.qty  { width:65px; }
.product-info-main .qty.field .control { margin-left:0px; }
.fotorama__fullscreen-icon {
    display: none !important;
}

.product .fotorama__stage__frame .fotorama__img {
       top: 0 !important;
       transform: none !important;
       -webkit-transform: none !important;
       position: static;
       margin-top: auto !important;
       border: 1px solid #999 !important;
}

.fotorama__stage { border: unset !important;}
span.original-price-no-special-price {
    display: none;
}span.remove-icon {
    display: none;
}
</style>

<style type="text/css">
    .field.choice.admin__field.admin__field-option.has-swatch {
    display: block;
    margin-left: 10px;
}

div.options-list.nested {
    display: inline-flex;
}
.field .label span {
    margin-right: 5px;
    color: #21293c;
    font-size: 15px;
    font-weight: 600;
    letter-spacing: .005em;
    text-transform: uppercase;
}

.field.choice .label span {
    margin-right: 5px;
    color: #21293c;
    font-size: 12px;
    font-weight: 400;
    letter-spacing: .005em;
    text-transform: uppercase;
}
.swatch {
    display: block;
    width: 75px;
    height: 75px;
    margin-top: 5px;
}.swatch img {
    width: 50px;
    height: 50px;
}
p.mage-error {
    color: red;
    font-size: 12px;
    margin: 5px auto;
	text-align:left;
}
span.price-notice { display: none; }
/*.swatch {
    display: inline-block;
    width: 50px;
    height: 50px;
}*/

#advancedoption .options-list.nested .cc {
    margin-right: 10px;
}

.advanced-product-option .field  label:first-child {
    color: #21293c;
    font-size: 15px;
    font-weight: 600;
    letter-spacing: .005em;
    text-transform: uppercase;
}
.advanced-product-option .field .label span,
.advanced-product-option .field  .control label.label {
    color: #7b7f83;
    font-size: 1.4rem;
    font-weight: 400;
    margin: 0 5px 5px 0;
    /* top: 5px; */
}

.advanced-product-option .field.choice {
    margin: 5px 0 10px 0;
}

.advanced-product-option .product-color-swatches {
    margin: 10px 0 0 0;
}


.advanced-product-option .field .control {
    margin: 5px 0 5px 0;
}

.advanced-product-option .field label.label:first-child span {
     color: #21293c;
     /* margin: 16px 0; */
     /* padding-bottom: 15px; */
     font-size: 15px;
     font-weight: 600;
     letter-spacing: .005em;
     text-transform: uppercase;
}

.advanced-product-option .field select.required-entry.advanced-product-option-field {
    width: auto;
}

.advanced-product-option .field label span.required-field, .advanced-product-option .field label.label span.required {
    color: red;
}

span.price {
    display: none;
}

.advanced-product-option .field select.advanced-product-option-field {
    width: auto;
    margin: 10px 0;
}
.advanced-product-option .field input.input-text {
    width: auto;
}

.advanced-product-option > .field {
    margin-top: 21px;
}

.advanced-product-option input[type="checkbox"] {
    margin: 4px;
    position: relative;
    top: 0px;
    vertical-align: top;
}
.advanced-product-option input[type="checkbox"] , .advanced-product-option input[type="radio"] { display: none; }

.advanced-product-option .field input.input-text {
    width: auto;
    background: transparent;
    border: none;
    padding: 2px 5px;
    border-bottom: 1px solid #000000;
}

.shape .options-list .field {
    margin-right: 10px;
}

.page-layout-1column .product-info-main { position: relative; }
.sums {
  visibility: hidden;
/*  display: none;
*/    min-height: 50px;
   /* position: absolute;
    float: right;
    top: 0;
     left: 102%;*/
     position: relative;
    display: flex;
/*    border-left: 2px solid #21293c;
*/}

.advanced-product-option > .field {
    border-top: 2px solid #ccc;
    padding-top: 21px;
}

.shape span.swatch-illusion img {
    width: 75px;
    height: 75px;
}
/*.sums {
  display: none;
        min-height: 50px;
      position: absolute;
    float: left;
    top: 7%;
    padding: 10px 10px;
    right: 7%;

    border-left: 2px solid #ccc;
}*/
/*.page-layout-1column .product-info-main { 
    border-right: 2px solid #ccc;  }*/
.sums p { width:200px; } 
.sums p span { text-transform: capitalize; } 

/* Desktops and laptops ----------- */
@media only screen 
and (min-width : 1024px) {
  /* Styles */

  .page-layout-1column .product-info-main, .page-layout-1column .product.media {
    width: 40%; float: left;
}
.product-info-main {
    margin-left: 20px;
}

}


.summary {
    background: #495a8336;
    padding: 10px;
    margin-left: 10px;
}
.options-list .field label span {
    display: none !important;
}
</style>


<script type="text/javascript">

require([
    'jquery',
], function ($) {

 $(document).ready(function() { 

  console.log(" load first ");


  setTimeout(function(){
           console.log(" ajaxcomplete  1 ");
                           if($("body").hasClass("page-product-advanced-option")) {
                  if($("body .advanced-product-option").find('.field').length !== 0) {      

     // $('body .advanced-product-option  input,body .advanced-product-option  select ').on('change', function() { 
    $(document).on('change', 'body .advanced-product-option  input,body .advanced-product-option  textarea ', function() { 

					//hide label of teext feilds 
					 $( "body .advanced-product-option .options-list  " ).each(function() {
                        $(this).find('.field').each(function() { 
                            if($(this).find('.product-color-swatches').length > 0){
                                $(this).find('label').hide();  
                            }
                          });

                         $(this).find('.choice').each(function() { 
                              if($(this).parent().find('.product-color-swatches').length > 0){
                                    $(this).find('label').hide();  
                                }
                          });

                         });
						// end 			
						

                var xt_sum = '<div id="loading-image" ></div>';
                $(" #summary").html(xt_sum);
                     $(".sums").css('visibility','visible');
						var preview = '' 
						var swatch_label = jQuery('.swatch-attribute-label').text();
						var swatch_value = jQuery('.swatch-attribute-selected-option').text();
						if(swatch_value.length > 0)
						{    preview = preview + " <p> <span> "+ swatch_label + " </span> : "+swatch_value+"</p>"; }
						$( ".advanced-product-option > .field" ).each(function() {
							var label =  $(this).find('label > span').first().text();
							var userval = '';
							$(this).find('input').each(function() {
									var type =  $( this ).attr('type'); 
									   if(type == "text" )
										{                               if($(this).val().length > 0){
							   
										 userval =   $( this ).val(); }
											  
										 }
										  if(type == "checkbox" || type == "radio")
										 {
												//if($(this).parent().find('input[type=checkbox]:checked').length > 0)
															  if($(this).prop("checked") == true){

												   var lbl = $( this ).parent().find('label').text(); 
												  if(lbl.length > 0)
												  {
													if(userval.length > 0)
													{ 
														  userval = userval + ","+ lbl;
													}else { userval = lbl; }
												  }else { userval = lbl; } 
													  var ttl = $( this ).closest('options-list').parent().parent().find('label').text(); 
												} 
										}
							});
							$(this).find('textarea').each(function() {
														var label =  $(this).find('label > span').first().text();	
														if($(this).val().length > 0){ userval =   $( this ).val(); }
							});
							if(label.length > 0)
							{          preview = preview + " <p> <span> "+ label + " </span> : "+userval+"</p>"; }
							// console.log("label = > " +capitalize(label)+" values =>"+userval);

					});
					  var summary = preview;
					  $("#summary").html(summary);
    });


		$(' .swatch-option ').on('click', function() {   

                var xt_sum = '<div id="loading-image" ></div>';
                $("#summary").html(xt_sum);
                $(".sums").css('visibility','visible');             //console.log(" ajaxcomplete  1  2");
				var preview = '' 
                var swatch_label = jQuery('.swatch-attribute-label').text();
                var swatch_value = jQuery('.swatch-attribute-selected-option').text();
                if(swatch_value.length > 0) {    preview = preview + " <p> <span> "+ swatch_label + " </span> : "+swatch_value+"</p>"; }
				$( ".advanced-product-option > .field" ).each(function() {
					var label =  $(this).find('label > span').first().text();
					var userval = '';
					$(this).find('input').each(function() {
                    var type =  $( this ).attr('type'); console.log(type); 
                       if(type == "text" )
                        {  if($(this).val().length > 0){  userval =   $( this ).val(); }                              
                        }
                        if(type == "checkbox" || type == "radio")
                        {   //if($(this).parent().find('input[type=checkbox]:checked').length > 0)
                           if($(this).prop("checked") == true){
                                  var lbl = $( this ).parent().find('label').text(); 
                                  if(lbl.length > 0)
                                  {
                                    if(userval.length > 0)
                                    { 
                                          userval = userval + ","+ lbl;
                                    }else { userval = lbl; }
                                  }else { userval = lbl; } 
                                      var ttl = $( this ).closest('options-list').parent().parent().find('label').text(); 
                                } 
                        }
				});
				 $(this).find('textarea').each(function() {
										var label =  $(this).find('label > span').first().text();	
										if($(this).val().length > 0){ userval =   $( this ).val(); }
						});
			
						if(label.length > 0)
						{          preview = preview + " <p> <span> "+ label + " </span> : "+userval+"</p>"; } 
				//	console.log("label = > " +capitalize(label)+" values =>"+userval);

				});
				var summary = preview;
				$("#summary").html(summary);
        });

                       function capitalize (str) {
                          return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();
                        }


                      }
					  
					  
					  // add border on product swatches of checbox list 
								$(document).on('change', 'body .advanced-product-option input[type=radio]', function() {
                                   $(' body .options-list.nested img').css('border', 'none'); //add a class to be more specific
                                   $(this).parent().find('img').css('border', 'solid 1px orange'); 
                                });

								$(document).on('click', 'body .options-list.nested .cc .product-color-swatches', function() {
                                   $(this).parent().find('input[type="checkbox"]').click(); 
                                });
								
									/* $(document).on('click', 'body .options-list.nested .cc .product-color-swatches ', function() { 
											$(this).parent().find('input[type="checkbox"]').click(); }); */
							/* 	 $(document).on('change', 'body .options-list.nested .cc .product-color-swatches ', function() { 
                                      if($(this).parent().find('input[type=checkbox]:checked').length > 0)
                                    {
                                     $(this).find('.swatch-illusion img').css('border', 'none'); //add a class to be more specific
                                    }else {
                                       $(this).find('.swatch-illusion img').css('border', 'solid 1px red');   }
                                    }); */
							/* $(document).on('change', 'body .advanced-product-option input[type=checkbox]', function() {		
							
                                    if($(this).parent().find('input[type=checkbox]:checked').length > 0)
                                {
                                 $(this).find('.swatch-illusion img').css('border', 'none'); //add a class to be more specific
                                }else {
                                   $(this).find('.swatch-illusion img').css('border', 'solid 1px orange');   }

                                }); */
								$(document).on('change', 'body .cutouts  input[type=checkbox]', function() {
									var index = $(".cutouts  input[type=checkbox]").index(this);
									if($(this).prop("checked") == true){
										 $(" .holes input[type=checkbox]:eq("+index+")").closest('.cc').find('.product-color-swatches img ').css("opacity","0.5"); 
                                         $(" .holes input[type=checkbox]:eq("+index+")").closest('.cc').css("cursor","none");
									}else {  $(" .holes input[type=checkbox]:eq("+index+")").closest('.cc').find('.product-color-swatches img ').css("opacity","1"); 
                                         $(" .holes input[type=checkbox]:eq("+index+")").closest('.cc').css("cursor","pointer"); } 
 
								 });		

							$(document).on('change', 'body .holes  input[type=checkbox]', function() {
									var index = $(".holes  input[type=checkbox]").index(this);

									if($(this).prop("checked") == true){
										 $(" .cutouts input[type=checkbox]:eq("+index+")").closest('.cc').find('.product-color-swatches img ').css("opacity","0.5"); 
                                         $(" .cutouts input[type=checkbox]:eq("+index+")").closest('.cc').css("cursor","none");
									}else {  $(" .cutouts input[type=checkbox]:eq("+index+")").closest('.cc').find('.product-color-swatches img ').css("opacity","1"); 
                                         $(" .cutouts input[type=checkbox]:eq("+index+")").closest('.cc').css("cursor","pointer"); } 
 
								 });	
                               // $("body .options-list.nested .cc .product-color-swatches").on('click', function(){ 
								    $(document).on('click', 'body .options-list.nested .cc .product-color-swatches ', function() { 
                                      if($(this).closest('.cc').find('input[type=checkbox]:checked').length > 0)
										{   $(this).find('.swatch-illusion img').css('border', 'solid 1px red');
										}else {  $(this).find('.swatch-illusion img').css('border', 'none');     }
                                    }); 

                           /*     $(" body .advanced-product-option input[type=radio]").on('change', function(){
                                   $(' body .options-list.nested img').css('border', 'none'); //add a class to be more specific
                                   $(this).parent().find('img').css('border', 'solid 1px orange'); 
                                }); 


                                $(" body .options-list.nested .cc .product-color-swatches").on('click', function(){ console.log("1234");
                                   $(this).parent().find('input[type="checkbox"]').click();
                                  
                                 
                                }); */
					//
                  }
				  
				  

           }, 4500);


                   setTimeout(function(){
               if($("body").hasClass("page-product-advanced-option")) {
                  
                                            $("body .advanced-product-option .shape .product-color-swatches:first").trigger('click');

                      $('body .width_a').parent('.field').css('border', 'none');
                      $('body .diameter').parent('.field').css('border', 'none');
                      $('body .length_b').parent('.field').css('border', 'none');
                      $('body .height_h').parent('.field').css('border', 'none');
                      $('body .base_c').parent('.field').css('border', 'none');


                   if($("body .advanced-product-option").find('.field').length !== 0) {

 var shape  = "";
							
							 $(document).on('change', 'body .diameter input ', function() { 
							 $( "body .shape  input" ).each(function() {
							   if($(this).prop("checked") == true){
								 shape = $( this ).parent().find('label').text(); 
							   }

							 });
							if($.trim(shape) == "CIRCLE")
								{   
									if($(this).val().length > 0)
										{
										 var canvas = document.getElementById("canvas");
									 if (canvas.getContext) { var ctx = canvas.getContext("2d");
											ctx.font = "12px Arial";
											ctx.fillText($(this).val()+"mm", 80, 220);
										ctx.save();	ctx.translate(20, 110); ctx.rotate(-Math.PI / 2);
											ctx.fillText($(this).val()+"mm",0 ,0 );  ctx.restore();
										 }
									   }
								}								
							});	
							 $(document).on('change', 'body .length_b input ', function() { 
							 $( "body .shape  input" ).each(function() {
							   if($(this).prop("checked") == true){
								 shape = $( this ).parent().find('label').text(); 
							   }

							 });
							if($.trim(shape) == "RECTANGLE")
								{   
									if($(this).val().length > 0)
										{
										 var canvas = document.getElementById("canvas");
									 if (canvas.getContext) { var ctx = canvas.getContext("2d");
											 ctx.save(); ctx.font = "12px Arial";
											ctx.translate(20, 130); ctx.rotate(-Math.PI / 2);
											ctx.fillText($(this).val()+"mm",0 ,0 ); ctx.restore();
										 }
									   }
								}	
								if($.trim(shape) == "TRIANGLE")
								{   
									if($(this).val().length > 0)
										{
										 var canvas = document.getElementById("canvas");
									 if (canvas.getContext) { var ctx = canvas.getContext("2d");
											 ctx.save(); ctx.font = "12px Arial";
											ctx.translate(20, 110); ctx.rotate(-Math.PI / 2);
											ctx.fillText($(this).val()+"mm",0 ,0 ); ctx.restore();
										 }
									   }
								}	
							if($.trim(shape) == "SQUARE")
								{   
									if($(this).val().length > 0)
										{
										 var canvas = document.getElementById("canvas");
											if (canvas.getContext) { var ctx = canvas.getContext("2d");
											  ctx.save(); ctx.font = "12px Arial";
											ctx.translate(20, 110); ctx.rotate(-Math.PI / 2);
											ctx.fillText($(this).val()+"mm",0 ,0 ); ctx.restore();
										 }
									   }
								}										
							});
							
							 $(document).on('change', 'body .width_a input ', function() { 
							 console.log("test ");
							 $( "body .shape  input" ).each(function() {
							   if($(this).prop("checked") == true){
								 shape = $( this ).parent().find('label').text(); 
							   }

							 });
							if($.trim(shape) == "RECTANGLE")
								{   
									if($(this).val().length > 0)
										{
										 var canvas = document.getElementById("canvas");
									 if (canvas.getContext) { var ctx = canvas.getContext("2d");
											ctx.font = "12px Arial";
											ctx.fillText($(this).val()+"mm",130, 200);
											
										 }
									   }
								}
							if($.trim(shape) == "TRIANGLE")
								{   
									if($(this).val().length > 0)
										{
										 var canvas = document.getElementById("canvas");
									 if (canvas.getContext) { var ctx = canvas.getContext("2d");
											ctx.font = "12px Arial";
											ctx.fillText($(this).val()+"mm", 90, 190);
											
										 }
									   }
								}	
							if($.trim(shape) == "SQUARE")
								{   
									if($(this).val().length > 0)
										{
										 var canvas = document.getElementById("canvas");
									 if (canvas.getContext) { var ctx = canvas.getContext("2d");
											ctx.font = "12px Arial";
											ctx.fillText($(this).val()+"mm",  100, 220);
											
										 }
									   }
								}								
							});
								
								

                   

							
							
									//if( $(" body .options-list.nested .cc .product-color-swatches").length > 0)
									//{
									
									//}
								  
									$(document).on('click', ' body .shape .product-color-swatches ', function() {   
                             

                                  if($(this).parent().find('input[type="checkbox"]').length > 0)
                                  {                                     
                                       $(this).parent().find('input[type="checkbox"]').click();
                                  }
                                  if($(this).parent().find('input[type="radio"]').length > 0)
                                  {
                                       $(this).parent().find('input[type="radio"]').click();
                                  }
								 // start custom option code 
								  //setTimeout(function(){
										$( "body .advanced-product-option .options-list  " ).each(function() {
											$(this).find('.field').each(function() { 
												if($(this).find('.product-color-swatches').length > 0){
													$(this).find('label').hide();  
												}
											  });

											 $(this).find('.choice').each(function() { 
												  if($(this).parent().find('.product-color-swatches').length > 0){
														$(this).find('label').hide();  
													}
											  });
											   $(document).on('change', 'body .options-list.nested .cc .product-color-swatches ', function() { 
									console.log(" product swatch clicked 1");
													  if($(this).parent().find('input[type=checkbox]:checked').length > 0)
													{
													 $(this).find('.swatch-illusion img').css('border', 'none'); //add a class to be more specific
													}else {
													   $(this).find('.swatch-illusion img').css('border', 'solid 1px red');   }
                                    });

									});
									          // }, 1500);

						  
								   //$(document).on('change', 'body .options-list.nested .cc .product-color-swatches ', function() { 
								$("body .options-list.nested .cc .product-color-swatches").on('click', function(){ 
								
									
                                      if($(this).parent().find('input[type=checkbox]:checked').length > 0)
                                    {
                                     $(this).find('.swatch-illusion img').css('border', 'none'); //add a class to be more specific
                                    }else {									
                                       $(this).find('.swatch-illusion img').css('border', 'solid 1px red');   }
										var shape  = "";
										$( "body .shape  input" ).each(function() {
										   if($(this).prop("checked") == true){
											 shape = $( this ).parent().find('label').text(); 
										   }
									   });	
									console.log("Shape : "+shape);
                                      if($(this).parent().find('input[type=checkbox]:checked').length > 0)
                                    {
                                     $(this).find('.swatch-illusion img').css('border', 'none'); //add a class to be more specific
                                    }else {									
                                       $(this).find('.swatch-illusion img').css('border', 'solid 1px red');   }
                                    
									if($.trim(shape) == "CIRCLE")
									{ 
										if($(this).parent().find('input[type=checkbox]:checked').length > 0)
										{
											if($(this).find('img').attr('tittle')  == "Circle Top hole")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d"); base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid grey.png';  base_image.onload = function(){	  ctx.drawImage(base_image,90, 30);}	}		
											  }
											 if($(this).find('img').attr('tittle')  == "Circle Bottom hole")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid grey.png';  base_image.onload = function(){	  ctx.drawImage(base_image,90, 160);}}
											 }
											 if($(this).find('img').attr('tittle')  == "Circle Left hole")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid grey.png';  base_image.onload = function(){	  ctx.drawImage(base_image,30, 90);}}
											 }
											 if($(this).find('img').attr('tittle')  == "Circle Center hole")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid grey.png';  base_image.onload = function(){	  ctx.drawImage(base_image,90, 90);}}
											 }
											 if($(this).find('img').attr('tittle')  == "Circle Right hole")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid grey.png';  base_image.onload = function(){	  ctx.drawImage(base_image,160, 90);} }
											 }							 
											}else {
												if($(this).find('img').attr('tittle')  == "Circle Top hole")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d"); base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid.png';  base_image.onload = function(){	  ctx.drawImage(base_image,90, 30);}	}		
											  }
											 if($(this).find('img').attr('tittle')  == "Circle Bottom hole")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid.png';  base_image.onload = function(){	  ctx.drawImage(base_image,90, 160);}}
											 }
											 if($(this).find('img').attr('tittle')  == "Circle Left hole")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid.png';  base_image.onload = function(){	  ctx.drawImage(base_image,30, 90);}}
											 }
											 if($(this).find('img').attr('tittle')  == "Circle Center hole")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid.png';  base_image.onload = function(){	  ctx.drawImage(base_image,90, 90);}}
											 }
											 if($(this).find('img').attr('tittle')  == "Circle Right hole")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid.png';  base_image.onload = function(){	  ctx.drawImage(base_image,160, 90);} }
											 }
											}
										}
										if($.trim(shape) == "TRIANGLE")
									{ 
										if($(this).parent().find('input[type=checkbox]:checked').length > 0)
										{
											if($(this).find('img').attr('tittle')  == "Triangle Top Hole")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d"); base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid grey.png';  base_image.onload = function(){	   ctx.drawImage(base_image,100, 70); }	}		
											  }
											 if($(this).find('img').attr('tittle')  == "Triangle Left Hole")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid grey.png';  base_image.onload = function(){	  ctx.drawImage(base_image, 55, 150);}}
											 }
											/*  if($(this).find('img').attr('tittle')  == "Triangle Top Hole")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid grey.png';  base_image.onload = function(){	   ctx.drawImage(base_image, 100, 150);}}
											 } */
											 if($(this).find('img').attr('tittle')  == "Triangle Right Hole")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid grey.png';  base_image.onload = function(){	 ctx.drawImage(base_image, 140, 150); }}
											 }
											 if($(this).find('img').attr('tittle')  == "Triangle Center Hole")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid grey.png';  base_image.onload = function(){	  ctx.drawImage(base_image,100, 110);} }
											 }							 
											}else {
												if($(this).find('img').attr('tittle')  == "Triangle Top Hole")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d"); base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid.png';  base_image.onload = function(){	    ctx.drawImage(base_image,100, 70);}	}		
											  }
											 if($(this).find('img').attr('tittle')  == "Triangle Left Hole")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid.png';  base_image.onload = function(){	  ctx.drawImage(base_image, 55, 150);}}
											 }
											/*  if($(this).find('img').attr('tittle')  == "Triangle Top Hole")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid.png';  base_image.onload = function(){	    ctx.drawImage(base_image, 100, 150);}}
											 } */
											 if($(this).find('img').attr('tittle')  == "Triangle Right Hole")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid.png';  base_image.onload = function(){	  ctx.drawImage(base_image, 140, 150); }}
											 }
											 if($(this).find('img').attr('tittle')  == "Triangle Center Hole")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid.png';  base_image.onload = function(){	  ctx.drawImage(base_image,100, 110);} }
											 }
											}
										}
										if($.trim(shape) == "SQUARE")
										{  console.log("Shape : "+shape + " type "+$(this).find('img').attr('tittle'));
											if($(this).parent().find('input[type=checkbox]:checked').length > 0)
											{
												//holes 
												if($(this).find('img').attr('tittle')  == "Square Top Left Hole ")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");  base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid grey.png';  base_image.onload = function(){	    ctx.drawImage(base_image, 60, 60);}}
											 }
											 if($(this).find('img').attr('tittle')  == "Square Top Right Hole ")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");//ctx.fillStyle = "grey"; ctx.fillRect(170, 60, 20, 20);
											  base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid grey.png';  base_image.onload = function(){	    ctx.drawImage(base_image, 170, 60);}}
											 }
											 if($(this).find('img').attr('tittle')  == "Square Bottom Left Hole ")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");//ctx.fillStyle = "grey";   ctx.fillRect(60, 170, 20, 20);
											  base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid grey.png';  base_image.onload = function(){	    ctx.drawImage(base_image, 60, 170);}}
											 }
											 if($(this).find('img').attr('tittle')  == "Square Bottom Right  Hole ")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");//ctx.fillStyle = "grey"; ctx.fillRect(170, 170, 20, 20);
											  base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid grey.png';  base_image.onload = function(){	    ctx.drawImage(base_image, 170, 170);}}
											 }
											 if($(this).find('img').attr('tittle')  == "Square Center  Hole")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");//ctx.fillStyle = "grey"; ctx.fillRect(115, 110, 20, 20);
											  base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid grey.png';  base_image.onload = function(){	    ctx.drawImage(base_image, 115, 110);}}
											 }	
												
												//cutouts 
											if($(this).find('img').attr('tittle')  == "Square Top Left Cutout")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");ctx.fillStyle = "grey";ctx.fillRect(60, 60, 20, 20);}
											 }
											 if($(this).find('img').attr('tittle')  == "Square Top Right Cutout")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");ctx.fillStyle = "grey"; ctx.fillRect(170, 60, 20, 20);}
											 }
											 if($(this).find('img').attr('tittle')  == "Square Bottom Left Cutout")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");ctx.fillStyle = "grey";   ctx.fillRect(60, 170, 20, 20);}
											 }
											 if($(this).find('img').attr('tittle')  == "Square Bottom Right Cutout")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");ctx.fillStyle = "grey"; ctx.fillRect(170, 170, 20, 20);}
											 }
											 if($(this).find('img').attr('tittle')  == "Square Center Cutout")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");ctx.fillStyle = "grey"; ctx.fillRect(115, 110, 20, 20);}
											 }	
											 
											}else {
											
											//holes 
													if($(this).find('img').attr('tittle')  == "Square Top Left Hole")
											 {			var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");//ctx.fillStyle = "white";ctx.fillRect(60, 60, 20, 20);
base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid.png';  base_image.onload = function(){	    ctx.drawImage(base_image, 60, 60);}											  }
											 }
											 if($(this).find('img').attr('tittle')  == "Square Top Right Hole ")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");//ctx.fillStyle = "white"; ctx.fillRect(170, 60, 20, 20);
											  base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid.png';  base_image.onload = function(){	    ctx.drawImage(base_image, 170, 60);}}
											 }
											 if($(this).find('img').attr('tittle')  == "Square Bottom Left Hole ")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");//ctx.fillStyle = "white";   ctx.fillRect(60, 170, 20, 20);
											  base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid.png';  base_image.onload = function(){	    ctx.drawImage(base_image, 60, 170);}}
											 }
											 if($(this).find('img').attr('tittle')  == "Square Bottom Right  Hole ")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");//ctx.fillStyle = "white"; ctx.fillRect(170, 170, 20, 20);
											  base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid.png';  base_image.onload = function(){	    ctx.drawImage(base_image, 170, 170);}}
											 }
											 if($(this).find('img').attr('tittle')  == "Square Center  Hole ")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");//ctx.fillStyle = "white"; ctx.fillRect(115, 110, 20, 20);
											  base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid.png';  base_image.onload = function(){	    ctx.drawImage(base_image, 115, 110);}}
											 }
												//cutouts
												if($(this).find('img').attr('tittle')  == "Square Top Left Cutout")
											 {			var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");ctx.fillStyle = "white";ctx.fillRect(60, 60, 20, 20);
														//ctx.arc(60, 60, 5, 0, 2 * Math.PI);ctx.fillStyle = "white";ctx.fill();
											  }
											 }
											 if($(this).find('img').attr('tittle')  == "Square Top Right Cutout")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");ctx.fillStyle = "white"; ctx.fillRect(170, 60, 20, 20);}
											 }
											 if($(this).find('img').attr('tittle')  == "Square Bottom Left Cutout")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");ctx.fillStyle = "white";   ctx.fillRect(60, 170, 20, 20);}
											 }
											 if($(this).find('img').attr('tittle')  == "Square Bottom Right  Cutout")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");ctx.fillStyle = "white"; ctx.fillRect(170, 170, 20, 20);}
											 }
											 if($(this).find('img').attr('tittle')  == "Square Center Cutout")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");ctx.fillStyle = "white"; ctx.fillRect(115, 110, 20, 20);}
											 }
											}
										}
										if($.trim(shape) == "RECTANGLE")
										{ 
											if($(this).parent().find('input[type=checkbox]:checked').length > 0)
											{
												
												//CUTOUTS 
												if($(this).find('img').attr('tittle')  == "Rectangle Top Left ")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");ctx.fillStyle = "grey";ctx.fillRect(60, 60, 20, 20);}
											 }
											 if($(this).find('img').attr('tittle')  == "Rectangle Top Right")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");ctx.fillStyle = "grey"; ctx.fillRect(230, 60, 20, 20);}
											 }
											 if($(this).find('img').attr('tittle')  == "Rectangle Bottom left ")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");ctx.fillStyle = "grey";   ctx.fillRect(60, 140, 20, 20);}
											 }
											 if($(this).find('img').attr('tittle')  == "Rectangle Bottom Right")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");ctx.fillStyle = "grey"; ctx.fillRect(230, 140, 20, 20);}
											 }
											 if($(this).find('img').attr('tittle')  == "Rectangle Center")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");ctx.fillStyle = "grey"; ctx.fillRect(150, 100, 20, 20);}
											 }		
											 
											 //HOLES
											if($(this).find('img').attr('tittle')  == "Top Left Rectangle Hole")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");ctx.fillStyle = "grey";//ctx.fillRect(60, 60, 20, 20);
											  var ctx = canvas.getContext("2d"); base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid grey.png';  base_image.onload = function(){	    ctx.drawImage(base_image,60, 60);}}
											 }
											 if($(this).find('img').attr('tittle')  == "Top Right Rectangle Hole")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");ctx.fillStyle = "grey"; //ctx.fillRect(210, 60, 20, 20);
											  var ctx = canvas.getContext("2d"); base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid grey.png';  base_image.onload = function(){	    ctx.drawImage(base_image,230, 60);}}
											 }
											 if($(this).find('img').attr('tittle')  == "Rectangle Bottom Left Hole")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");ctx.fillStyle = "grey";  // ctx.fillRect(60, 140, 20, 20);
											  var ctx = canvas.getContext("2d"); base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid grey.png';  base_image.onload = function(){	    ctx.drawImage(base_image,60, 140);}
											  }
											 }
											 if($(this).find('img').attr('tittle')  == "Bottom Right Rectangle Hole")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");ctx.fillStyle = "grey"; //ctx.fillRect(210, 140, 20, 20);
											  var ctx = canvas.getContext("2d"); base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid grey.png';  base_image.onload = function(){	    ctx.drawImage(base_image,230, 140);}}
											 }
											 if($(this).find('img').attr('tittle')  == "Center Rectangle Hole")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");ctx.fillStyle = "grey"; //ctx.fillRect(140, 100, 20, 20);
											  var ctx = canvas.getContext("2d"); base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid grey.png';  base_image.onload = function(){	    ctx.drawImage(base_image,150, 100);}
											  }
											 }									 
											}else {
													//CUTOUTS 
														if($(this).find('img').attr('tittle')  == "Rectangle Top Left ")
											 {			var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");ctx.fillStyle = "white";ctx.fillRect(60, 60, 20, 20);
														//ctx.arc(60, 60, 5, 0, 2 * Math.PI);ctx.fillStyle = "white";ctx.fill();
											  }
											 }
											 if($(this).find('img').attr('tittle')  == "Rectangle Top Right")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");ctx.fillStyle = "white"; ctx.fillRect(230, 60, 20, 20);}
											 }
											 if($(this).find('img').attr('tittle')  == "Rectangle Bottom left ")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");ctx.fillStyle = "white";   ctx.fillRect(60, 140, 20, 20);}
											 }
											 if($(this).find('img').attr('tittle')  == "Rectangle Bottom Right")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");ctx.fillStyle = "white"; ctx.fillRect(230, 140, 20, 20);}
											 }
											 if($(this).find('img').attr('tittle')  == "Rectangle Center")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");ctx.fillStyle = "white"; ctx.fillRect(150, 100, 20, 20);}
											 }
												//HOLES
												if($(this).find('img').attr('tittle')  == "Top Left Rectangle Hole")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");ctx.fillStyle = "white";//ctx.fillRect(60, 60, 20, 20);
											  var ctx = canvas.getContext("2d"); base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid.png';  base_image.onload = function(){	    ctx.drawImage(base_image,60, 60);}}
											 }
											 if($(this).find('img').attr('tittle')  == "Top Right Rectangle Hole")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");ctx.fillStyle = "white"; //ctx.fillRect(210, 60, 20, 20);
											  var ctx = canvas.getContext("2d"); base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid.png';  base_image.onload = function(){	    ctx.drawImage(base_image,230, 60);}}
											 }
											 if($(this).find('img').attr('tittle')  == "Rectangle Bottom Left Hole")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");ctx.fillStyle = "white";  // ctx.fillRect(60, 140, 20, 20);
											  var ctx = canvas.getContext("2d"); base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid.png';  base_image.onload = function(){	    ctx.drawImage(base_image,60, 140);}
											  }
											 }
											 if($(this).find('img').attr('tittle')  == "Bottom Right Rectangle Hole")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");ctx.fillStyle = "white"; //ctx.fillRect(210, 140, 20, 20);
											  var ctx = canvas.getContext("2d"); base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid.png';  base_image.onload = function(){	    ctx.drawImage(base_image,230, 140);}}
											 }
											 if($(this).find('img').attr('tittle')  == "Center Rectangle Hole")
											 {
											  var canvas = document.getElementById("canvas");if (canvas.getContext) {var ctx = canvas.getContext("2d");ctx.fillStyle = "white"; //ctx.fillRect(140, 100, 20, 20);
											  var ctx = canvas.getContext("2d"); base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/circle-solid.png';  base_image.onload = function(){	    ctx.drawImage(base_image,150, 100);}
											  }
											 }
											}
										}
									
                                    
							});
									
								//End custom option code
								  if($(this).find('img').attr('tittle') == "CIRCLE")
                                  { 
									var canvass = document.getElementById("canvas");
										if (canvass.getContext) {
										var ctx = canvass.getContext("2d");
											ctx.clearRect(0, 0, canvass.width, canvass.height);

										//define the colour of the circle
									//	ctx.strokeStyle = "grey";
										var centreX = 100;
										var centreY = 100;
										var radius = 75;
										
										// convert start angle '0 degrees' to radians
										var startAngle = 0 * Math.PI/180;

										//convert end angle '360 degrees' to radians
										var endAngle = 360 * Math.PI/180;

										//define the circle
										ctx.arc(centreX,centreY,radius,startAngle,endAngle,false);
												ctx.fillStyle = "grey";									
      ctx.fill();
										//draw the circle
										//ctx.stroke();
										}	
								  }
								  
								   if($(this).find('img').attr('tittle') == "SQUARE")
                                  { 
											var canvas = document.getElementById("canvas");
												if (canvas.getContext) {
												var ctx = canvas.getContext("2d");
																							ctx.clearRect(0, 0, canvas.width, canvas.height);

												//define the colour of the square
												ctx.fillStyle = "grey";									

												// Draw a square using the fillRect() method and fill it with the colour specified by the fillStyle attribute
												//ctx.fillRect(200,50,100,100);
												ctx.fillRect(50,50,150,150);
												}
								  }
								  
								   if($(this).find('img').attr('tittle') == "TRIANGLE")
                                  { 	
											var canvas = document.getElementById("canvas");
												if (canvas.getContext) {
												var ctx = canvas.getContext("2d");
												ctx.clearRect(0, 0, canvas.width, canvas.height);
												 base_image = new Image();
											  base_image.src = 'https://m2.metalcuttosize.co.uk/pub/media/theme/triangle.png';
											  base_image.onload = function(){	    ctx.drawImage(base_image,40, 50);}

										//let height = 100 * Math.cos(Math.PI / 6);

										 // ctx.beginPath();
										 // ctx.moveTo(50, 200);
										 // ctx.lineTo(200, 200);
										 // ctx.lineTo(120, 160 - height);
										 // ctx.closePath();

										  // the outline
										 // ctx.lineWidth = 10;
										//  ctx.strokeStyle = 'grey';
										//  ctx.stroke();

										  // the fill color
										 // ctx.fillStyle = "grey";
										 // ctx.fill();
												
										}
								  }
								  
								   if($(this).find('img').attr('tittle') == "RECTANGLE")
                                  { 
									var canvas = document.getElementById("canvas");
										if (canvas.getContext) {
										var ctx = canvas.getContext("2d");
											ctx.clearRect(0, 0, canvas.width, canvas.height);
										//define the fill colour of the rectangle
										ctx.fillStyle = "grey";
										ctx.fillRect(50,50,200,120);
										}
								  }
								  
								  

                                  $('body .width_a').parent('.field').css('border', 'none');
								  $('body .diameter').parent('.field').css('border', 'none');
								  $('body .length_b').parent('.field').css('border', 'none');
								  $('body .height_h').parent('.field').css('border', 'none');
								  $('body .base_c').parent('.field').css('border', 'none');

                              });

                            




                    }  
                }  
         }, 4000);


 });

});


    require(["jquery",'underscore',    'mage/validation'
],function($,_) {


 $(document).ready(function() { 
              $('.price-box').find('span.price').hide(); $('.box-tocart').hide();

        
             $('body .options-list  input').on('change', function() {
                    var txt =  jQuery( this ).parent().find( ".label span" ).text(); console.log(txt);
                    var txt1 =  jQuery( this ).parent().find( ".label " ).text(); console.log(txt1);
                  $('.product-info-price').find('span.price').hide(); $('.box-tocart').hide(); $('.price-box').find('span.price').hide();
                  console.log("abc1");
                  var pp = parseFloat(0); // var abc = 0;

                  jQuery("body #product-options-wrapper input[type=radio]:checked").each(function() {
                 
                         if(this.value == "NaN"){ var abc = 0; }
                         if(jQuery(this).attr('price') !== typeof undefined && jQuery(this).attr('price') !== false ) 
                         {
                           var abc = parseFloat(jQuery(this).attr('price'));
                         } else{ var abc = 0;   }  
                          if(!$.isNumeric(abc)){ abc = 0; } console.log(abc+"abcc-price");
                           pp = pp + abc;  console.log(pp+"pp-price");
                           $('body #custom_option_price_cal').val(pp);
                  });               

                    var price_custom_option = $('body #custom_option_price_cal').val();
                    console.log(price_custom_option);
                    var c_price = $('body #custom_price_cal').val();
                               if(!$.isNumeric(c_price)){ c_price = 0; }

                      $('span.price').text('-');  $('span.price').show();
                    var cc_price = (parseFloat)(c_price) + (parseFloat)(price_custom_option);
                      $('span.price').text('Â£'+cc_price);

            });
      

            $('body #product-options-wrapper .field.required  input').on('change', function() {   
                 $('.box-tocart').hide();$('.price-box').find('span.price').hide();   
            });


          $(document).on('click','#calculate',function() {

                    var form = '#product_addtocart_form';
                      if ($(form).validation() && $(form).validation('isValid')) {
                       console.log("validation true");   //true 
                      } else { console.log("validation false");
                          return false;
                      }
                    $('#loading-image').show();

										
                $('.product-info-price').find('span.price').hide();  $('.box-tocart').hide();
                     var selected_options = {};
                    jQuery('div.swatch-attribute').each(function(k,v){
                        var attribute_id    = jQuery(v).attr('attribute-id');
                        var option_selected = jQuery(v).attr('option-selected');
                        //console.log(attribute_id, option_selected);
                        if(!attribute_id || !option_selected){ 
                          return; } 
                          // if(!$.isNumeric(option_selected)){ jQuery( this ).append("<p class='error'> This is required field </p>");  }
                        selected_options[attribute_id] = option_selected;
                    });

                var product_id_index = jQuery('[data-role=swatch-options]').data('mageSwatchRenderer').options.jsonConfig.index;
                var found_ids = []; var selected_product_id;
                jQuery.each(product_id_index, function(product_id,attributes){
                    var productIsSelected = function(attributes, selected_options){
                        return _.isEqual(attributes, selected_options);
                    }
                    if(productIsSelected(attributes, selected_options)){  console.log(product_id);
                       // found_ids.push(product_id);
                         selected_product_id = product_id; console.log(selected_product_id);
                    } 
                });
                var length = 0;          var width = 0; var thick = 0;

                    var isvalid =  false;
                   jQuery('div.swatch-attribute').each(function(k,v){
                      if($(this).find('.swatch-attribute-selected-option').text() == "")
                      {
                        isvalid = false; jQuery( this ).append('<p class="mage-error">This is required field</p>');
                        setTimeout(function() {     jQuery('.mage-error').remove();   }, 2000);
                      }else {  isvalid = true; }
                    });
									
					
					
                               jQuery( "#product-options-wrapper .field.required" ).each(function() {
                                             var txt =  jQuery( this ).find( ".label" ).text(); console.log(txt);
                                             if(jQuery.trim(txt) == "length" || jQuery.trim(txt) == "Length" || jQuery.trim(txt) == "LENGTH" )
                                             {
                                                length = jQuery( this ).find(".input-text").val(); console.log(length);
                                                if(!$.isNumeric(length)){  isvalid = false; 
                                                  jQuery( this ).find('.control ').append('<p class="mage-error">This is required field</p>');
                                                setTimeout(function() {  jQuery('.mage-error').remove();   }, 2000);
                                          }else {  isvalid = true; }
                                             }

                                             if(jQuery.trim(txt) == "width" || jQuery.trim(txt) == "Width" || jQuery.trim(txt) == "WIDTH" )
                                             {
                                                width = jQuery( this ).find(".input-text").val(); console.log(width);
                                             }/*if(jQuery.trim(txt) == "depth" || jQuery.trim(txt) == "Depth" )
                                             {
                                               var depth = jQuery( this ).find(".input-text").val(); console.log(val);
                                             }*/
                               });
							   
							   if($('body .holesize input ').length && $('body .holesize input ').val().length !== 0)
										{	
											 if($('body .holesize input ').val() >= 5 &&  $('body .holesize input ').val() <= 25){  isvalid = true;
                                          }else {  isvalid = false; 
                                                  jQuery( this ).parent().append('<p class="mage-error">Hole size should be between 5 and 25</p>');
                                                setTimeout(function() {  jQuery('.mage-error').remove();   }, 2000); }
												
										}
										if($('body .cutoutsize input ').length && $('body .cutoutsize input ').val().length !== 0)
										{	
											 if($('body .cutoutsize input ').val() >= 5 &&  $('body .cutoutsize input ').val() <= 25){  isvalid = true;
                                          }else {  isvalid = false; 
                                                  jQuery( this ).parent().append('<p class="mage-error">Cutout size should be between 5 and 25</p>');
                                                setTimeout(function() {  jQuery('.mage-error').remove();   }, 2000); }
												
										}



                               if($("body .advanced-product-option").find('.shape').length !== 0) {

                                      $("body .shape input[type=radio]:checked").each(function() {
                                          var txt =  jQuery( this ).parent().find( ".label" ).text(); console.log(txt);
                                          if($.trim(txt) == "circle" || $.trim(txt) == "Circle" || $.trim(txt) == "CIRCLE" )
                                          { 
                                             var dia = jQuery( ".diameter" ).find(".input-text").val(); console.log(dia+" -- Dia");
                                             length = dia; width = dia;

                                          }
                                           if($.trim(txt) == "Square" || $.trim(txt) == "Square" || $.trim(txt) == "SQUARE" )
                                          { 
                                             width = jQuery( ".width_a" ).find(".input-text").val(); console.log(width+" -- width_a");
                                             length = jQuery( ".length_b" ).find(".input-text").val(); console.log(dia+" -- length_b");

                                          }
                                           if($.trim(txt) == "triangle" || $.trim(txt) == "Triangle" || $.trim(txt) == "TRIANGLE" )
                                          { 
                                            var nums = [];
                                            $("body .advanced-product-option input[type=text]").each( function() { nums.push( $(this).val() ); });
                                              var max = Math.max.apply(Math, nums);
                                             length = max; width = max; console.log(max+" -- len trianlge");


                                          }
                                           if($.trim(txt) == "rectangle" || $.trim(txt) == "Rectangle" || $.trim(txt) == "RECTANGLE" )
                                          { 
                                              width = jQuery( ".width_a" ).find(".input-text").val(); console.log(width+" -- width_a");
                                             length = jQuery( ".length_b" ).find(".input-text").val(); console.log(dia+" -- length_b");

                                          }


                                      });
                                

                               }
console.log(isvalid+"  isvalid  ");
                                        var thick1 =$(".swatch-attribute.thickness  div ").attr('aria-activedescendant');
                                        var thick = $("#"+thick1).html(); // $("#attribute159").val();
                           // var length =  $("#options_5_text").val();//  var width =  $("#options_6_text").val();   // var selected_product_id =  $("input[name='selected_configurable_option']").val();
                                var customurl = "<?php echo $this->getUrl().'calculate'?>";
                                 $("#error-msg").hide();
                                 if(isvalid == true)
                                 {
                                $.ajax({
                                    url: customurl,
                                    type: 'POST',
                                    dataType: 'json',
                                    data: {
                                        length: length,
                                        width: width,
                                        thick: thick, selected_product_id: selected_product_id,
                                        productid: <?php echo $productid; ?>
                                    },
                                     success: function(response) {
                                                      console.log(' rr '+response); 
                                    if(response.status)
                                    {
                                          var custom_p = response.price;
                                     // state = response.responseJSON.state;         
                                      console.log(' price '+custom_p); 
                                      $('#custom_price_cal').val(custom_p);
                                     var pp = parseFloat(0); // var abc = 0;

                                jQuery("body #product-options-wrapper input[type=radio]:checked").each(function() {
                                                  

                                 if(this.value == "NaN"){ var abc = 0; }
                                 if(jQuery(this).attr('price') !== typeof undefined && jQuery(this).attr('price') !== false ) 
                                 {
                                   var abc = parseFloat(jQuery(this).attr('price'));
                                 } else{ var abc = 0;   }  
                                  if(!$.isNumeric(abc)){ abc = 0; } console.log(abc+"abcc-price");
                                   pp = pp + abc;  console.log(pp+"pp-price");
                                   $('body #custom_option_price_cal').val(pp);
                                }); 
                                  var price_custom_option = $('body #custom_option_price_cal').val();
                                  var price_advanced_custom_option = $('body #advanced_custom_option_price_cal').val();
                                  console.log(price_custom_option);
                                   var custom_p1 = parseFloat(custom_p);  
                                  if($.isNumeric(price_custom_option))
                                  {   custom_p1 = parseFloat(custom_p1) +  parseFloat(price_custom_option);  
                                  }
                                  if($.isNumeric(price_advanced_custom_option))
                                  {   custom_p1 = parseFloat(custom_p1) +  parseFloat(price_advanced_custom_option);  
                                  }
                                                             
                                      $('span.price').text('Â£'+custom_p1);
                                      $('.box-tocart').show();$('.price-box').find('span.price').show();  
                                      

                                      }else {                   console.log(' msg '+response.msg); 
                                                    //setTimeout(function() {
                                                $("#error-msg").show().html("<p>"+response.msg+"</p>"); 
                                                $('#error-msg').hide().delay(2000).fadeIn(400);      // }, 2000 );   
                                       }          
                                    },
                                complete: function(response) {   
                                  $('#loading-image').hide();

                                    },           

                              }); }


                        });


      

        });
    });
</script>


    <script type="text/javascript">
    require(['jquery','Magento_Catalog/js/price-utils','jquery/ui'], function ($,priceUtils) 
    {
     $(document).ready(function(){

        $('body .options-list  input').on('change', function(){ 

        var finalPrice='200.55';
         var c_price = jQuery('#custom_price_cal').val();
           if(!$.isNumeric(c_price)){ c_price = 0; }
                       var pp = parseFloat(0); // var abc = 0;

            jQuery("body #product-options-wrapper input[type=radio]:checked").each(function() {
           
             if(this.value == "NaN"){ var abc = 0; }
             if(jQuery(this).attr('price') !== typeof undefined && jQuery(this).attr('price') !== false ) 
             {
               var abc = parseFloat(jQuery(this).attr('price'));
             } else{ var abc = 0;   }  
               if(!$.isNumeric(abc)){ abc = 0; } console.log(abc+"abcc-price");
               pp = pp + abc;  console.log(pp+"pp-price");
               $('body #custom_option_price_cal').val(pp);
            }); 
              var price_custom_option = $('body #custom_option_price_cal').val();
              console.log(price_custom_option);
         // var price_custom_option = $('input[type=radio]:checked', '.options-list').attr('price');
          //if(price_custom_option.length == 0) { price_custom_option = 0; }
              console.log(price_custom_option);
         finalPrice = c_price + price_custom_option;
         
                   //   finalPrice = finalPrice + parseFloat(price_custom_option);
        finalPrice=(pricePerText*textObjects)+(pricePerImage*imageObjects);

        formatedPrice = priceUtils.formatPrice(parseFloat(finalPrice));
        jQuery('span.price-final_price > span.price-wrapper > span.price').text(formatedPrice);
 
        });


    });

    });
    </script>
